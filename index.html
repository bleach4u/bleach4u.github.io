<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Draft Tournament Tool</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#181c23;
  --panel2:#1f2430;
  --accent:#4da3ff;
  --text:#e6e9ef;
  --border:#2a3140;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI, system-ui, sans-serif;
}

.container{max-width:1200px;margin:auto;padding:20px;}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
  margin-bottom:18px;
}

textarea{
  width:100%;
  background:var(--panel2);
  border:1px solid var(--border);
  color:var(--text);
  padding:12px;
  border-radius:10px;
  font-family:"Consolas","Courier New",monospace;
  font-size:14px;
  resize:vertical;
  box-sizing:border-box;
  overflow:auto;
}

.controls{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

button{
  background:var(--accent);
  border:none;
  padding:10px 16px;
  border-radius:10px;
  color:white;
  font-weight:600;
  cursor:pointer;
}

button.secondary{background:#2c3444}

input[type=number]{
  width:80px;
  background:#252526;
  color:#fff;
  border:1px solid #2a3140;
  padding:6px 8px;
  border-radius:6px;
}

.player{
  background:var(--panel2);
  padding:6px 10px;
  border-radius:8px;
  margin:4px;
  display:inline-block;
  cursor:pointer;
}

.player.selected{background:#ffb84d;color:black}

textarea::-webkit-scrollbar{width:12px;}
textarea::-webkit-scrollbar-track{background:#252526;}
textarea::-webkit-scrollbar-thumb{
  background:#4da3ff;
  border-radius:6px;
  border:3px solid #252526;
}
</style>
</head>

<body>
<div class="container">

<h1>Draft Tournament Tool</h1>

<!-- INPUT -->
<div class="card" id="inputCard">
<textarea id="input" rows="10" placeholder="Paste check-in list..."></textarea>

<div class="controls">
<label>Team size:</label>
<input id="teamSize" type="number" value="5" min="1">

<button onclick="generateRandom()">ðŸŽ² Random</button>
<button onclick="prepareCaptainSelect()">ðŸ‘‘ Draft (Manual Captains)</button>

<button onclick="copyOutput()">Copy Output</button>
<button class="secondary" onclick="copyShareLink()">Share Results</button>
</div>
</div>

<!-- CAPTAIN SELECT -->
<div class="card" id="captainArea" style="display:none">
<h3>Select Captains</h3>
<div id="captainPool"></div>
<div class="controls">
<button onclick="startDraft()">Start Draft</button>
</div>
</div>

<!-- DRAFT -->
<div class="card" id="draftArea" style="display:none">
<h3>Draft Mode</h3>
<div id="draftInfo"></div>
<div id="available"></div>
<div class="controls">
<button onclick="undoPick()">Undo Pick</button>
</div>
</div>

<!-- OUTPUT -->
<div class="card">
<h3>Output</h3>
<textarea id="output" rows="14" readonly></textarea>
</div>

</div>

<script>
let allPlayers=[], captains=[], players=[], teams=[], order=[], turn=0, history=[];

/* ===== UTIL ===== */
function extractPlayers(text){
  const lines=text.split("\n");
  const arr=[];
  const r=/\d+\s+(.+?)\s+Checked In/i;
  for(const l of lines){
    const m=l.match(r);
    if(m) arr.push(m[1]);
  }
  return arr;
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

/* ===== RANDOM ===== */
function generateRandom(){
  const p=extractPlayers(input.value);
  const size=parseInt(teamSize.value)||5;
  shuffle(p);

  let out="", t=1;
  for(let i=0;i<p.length;i+=size){
    out+=`Team ${t++}:\n`;
    p.slice(i,i+size).forEach(x=>out+="  "+x+"\n");
    out+="\n";
  }
  output.value=out;
}

/* ===== CAPTAIN SELECT ===== */
function prepareCaptainSelect(){
  allPlayers=extractPlayers(input.value);
  captains=[];
  captainPool.innerHTML="";
  captainArea.style.display="block";
  draftArea.style.display="none";

  allPlayers.forEach(p=>{
    const el=document.createElement("div");
    el.className="player";
    el.textContent=p;
    el.onclick=()=>{
      if(captains.includes(p)){
        captains=captains.filter(x=>x!==p);
        el.classList.remove("selected");
      }else{
        captains.push(p);
        el.classList.add("selected");
      }
    };
    captainPool.appendChild(el);
  });
}

/* ===== START DRAFT ===== */
function startDraft(){
  const size=parseInt(teamSize.value)||5;
  if(captains.length===0) return alert("Select captains");

  teams=captains.map(c=>[c]);
  players=allPlayers.filter(p=>!captains.includes(p));

  const teamCount=captains.length;
  order=[];
  for(let r=0;r<size-1;r++){
    const arr=[...Array(teamCount).keys()];
    if(r%2===1) arr.reverse();
    order.push(...arr);
  }

  turn=0; history=[];
  captainArea.style.display="none";
  draftArea.style.display="block";
  renderDraft();
}

function renderDraft(){
  if(turn>=order.length){ finishDraft(); return; }

  draftInfo.textContent="Captain picking: "+captains[order[turn]];
  available.innerHTML="";

  players.forEach(p=>{
    const el=document.createElement("div");
    el.className="player";
    el.textContent=p;
    el.onclick=()=>pick(p);
    available.appendChild(el);
  });
}

function pick(p){
  const teamIndex=order[turn];
  teams[teamIndex].push(p);
  history.push({p,teamIndex});
  players=players.filter(x=>x!==p);
  turn++;
  renderDraft();
}

function undoPick(){
  if(!history.length) return;
  const last=history.pop();
  teams[last.teamIndex].pop();
  players.push(last.p);
  turn--;
  renderDraft();
}

function finishDraft(){
  let out="";
  teams.forEach((t,i)=>{
    out+=`Team ${i+1} (${captains[i]}):\n`;
    t.forEach(p=>out+="  "+p+"\n");
    out+="\n";
  });
  output.value=out;
  draftArea.style.display="none";
}

/* ===== COPY ===== */
function copyOutput(){
  output.select();
  document.execCommand("copy");
}

/* ===== SHARE RESULTS ONLY ===== */
function copyShareLink(){
  if(!output.value.trim()){
    alert("Generate teams first!");
    return;
  }

  const shareData = {
    output: output.value,
    size: teamSize.value
  };

  const url = location.origin + location.pathname +
              "?data=" + btoa(JSON.stringify(shareData));

  navigator.clipboard.writeText(url);
  alert("Results link copied!");
}

/* ===== LOAD SHARED RESULT ===== */
function loadFromURL(){
  const p=new URLSearchParams(location.search);
  if(!p.has("data")) return;

  const decoded=JSON.parse(atob(p.get("data")));

  if(decoded.output){
    output.value=decoded.output;
    inputCard.style.display="none"; // clean results view
  }

  if(decoded.size){
    teamSize.value=decoded.size;
  }
}

loadFromURL();
</script>
</body>
</html>
