<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Draft Tournament Tool</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#181c23;
  --panel2:#1f2430;
  --accent:#4da3ff;
  --text:#e6e9ef;
  --border:#2a3140;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI, system-ui, sans-serif;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
  margin-bottom:18px;
}

textarea{
  width:100%;
  background:var(--panel2);
  border:1px solid var(--border);
  color:var(--text);
  padding:12px;
  border-radius:10px;
  font-family:"Consolas","Courier New",monospace;
  font-size:14px;
  resize:vertical;
  box-sizing:border-box;
  overflow:auto;
}

.controls{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

button{
  background:var(--accent);
  border:none;
  padding:10px 16px;
  border-radius:10px;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition:.15s;
}

button.secondary{background:#2c3444}

button:hover{filter:brightness(1.1);transform:translateY(-1px)}

input[type=number]{
  width:80px;
  background:#252526;
  color:#fff;
  border:1px solid #2a3140;
  padding:6px 8px;
  border-radius:6px;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button{
  -webkit-appearance:none;
  margin:0;
}

.player{
  background:var(--panel2);
  padding:6px 10px;
  border-radius:8px;
  margin:4px;
  display:inline-block;
  cursor:pointer;
}

.player.selected{background:#ffb84d;color:black}

.team{margin-bottom:10px}

/* Scrollbar */
textarea::-webkit-scrollbar{
  width:12px;
}
textarea::-webkit-scrollbar-track{
  background:#252526;
  border-radius:6px;
}
textarea::-webkit-scrollbar-thumb{
  background:#4da3ff;
  border-radius:6px;
  border:3px solid #252526;
}
</style>
</head>

<body>
<div class="container">

<h1>Draft Tournament Tool</h1>

<!-- INPUT CARD -->
<div class="card">
<textarea id="input" rows="10" placeholder="Paste check-in list..."></textarea>

<div class="controls">
<label>Team size:</label>
<input id="teamSize" type="number" value="5" min="1">

<button onclick="generateRandom()">ðŸŽ² Random</button>
<button onclick="prepareCaptainSelect()">ðŸ‘‘ Draft (Manual Captains)</button>

<button onclick="copyOutput()">Copy Output</button>
<button class="secondary" onclick="copyShareLink()">Share</button>
</div>
</div>

<!-- CAPTAIN SELECTION -->
<div class="card" id="captainArea" style="display:none">
<h3>Select Captains (click players)</h3>
<div id="captainPool"></div>
<div class="controls">
<button onclick="startDraft()">Start Draft</button>
</div>
</div>

<!-- DRAFT PICKING -->
<div class="card" id="draftArea" style="display:none">
<h3>Draft Mode</h3>
<div id="draftInfo" style="margin-bottom:10px"></div>
<div id="available"></div>
<div class="controls">
<button onclick="undoPick()">Undo Pick</button>
</div>
</div>

<!-- OUTPUT -->
<div class="card">
<h3>Output</h3>
<textarea id="output" rows="12" readonly></textarea>
</div>

</div>

<script>
let allPlayers=[], captains=[], players=[], teams=[], order=[], turn=0, history=[], currentMode="random";

/* ===== UTILS ===== */
function extractPlayers(text){
  const lines=text.split("\n");
  const arr=[];
  const r=/\d+\s+(.+?)\s+Checked In/i;
  for(const l of lines){
    const m=l.match(r);
    if(m) arr.push(m[1]);
  }
  return arr;
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

/* ===== RANDOM MODE ===== */
function generateRandom(){
  currentMode="random";
  const p=extractPlayers(input.value);
  const size=parseInt(teamSize.value)||5;
  shuffle(p);
  let out="", t=1;
  for(let i=0;i<p.length;i+=size){
    out+=`Team ${t++}:\n`;
    p.slice(i,i+size).forEach(x=>out+="  "+x+"\n");
    out+="\n";
  }
  output.value=out;
}

/* ===== MANUAL CAPTAIN SELECTION ===== */
function prepareCaptainSelect(){
  currentMode="draft";
  allPlayers=extractPlayers(input.value);
  captains=[];
  captainPool.innerHTML="";
  captainArea.style.display="block";
  draftArea.style.display="none";

  allPlayers.forEach(p=>{
    const el=document.createElement("div");
    el.className="player";
    el.textContent=p;
    el.onclick=()=>{
      if(captains.includes(p)){
        captains=captains.filter(x=>x!==p);
        el.classList.remove("selected");
      }else{
        captains.push(p);
        el.classList.add("selected");
      }
    };
    captainPool.appendChild(el);
  });
}

function startDraft(){
  const size=parseInt(teamSize.value)||5;
  if(captains.length===0) return alert("Select at least one captain!");
  teams=captains.map(c=>[c]);
  players=allPlayers.filter(p=>!captains.includes(p));
  const teamCount=captains.length;
  order=[];
  for(let r=0;r<size-1;r++){
    const arr=[...Array(teamCount).keys()];
    if(r%2===1) arr.reverse();
    order.push(...arr);
  }
  turn=0; history=[];
  captainArea.style.display="none";
  draftArea.style.display="block";
  renderDraft();
}

function renderDraft(){
  if(turn>=order.length){
    finishDraft();
    return;
  }
  draftInfo.textContent="Captain picking: "+captains[order[turn]];
  available.innerHTML="";
  players.forEach(p=>{
    const el=document.createElement("div");
    el.className="player";
    el.textContent=p;
    el.onclick=()=>pick(p);
    available.appendChild(el);
  });
}

function pick(p){
  const teamIndex=order[turn];
  teams[teamIndex].push(p);
  history.push({p,teamIndex});
  players=players.filter(x=>x!==p);
  turn++;
  renderDraft();
}

function undoPick(){
  if(history.length===0) return;
  const last=history.pop();
  teams[last.teamIndex].pop();
  players.push(last.p);
  turn--;
  renderDraft();
}

function finishDraft(){
  let out="";
  teams.forEach((t,i)=>{
    out+=`Team ${i+1} (${captains[i]}):\n`;
    t.forEach(p=>out+="  "+p+"\n");
    out+="\n";
  });
  output.value=out;
  draftArea.style.display="none";
}

/* ===== COPY & SHARE ===== */
function copyOutput(){
  output.select();
  document.execCommand("copy");
}

function copyShareLink(){
  const shareData = {
    mode: currentMode,
    input: input.value,
    size: teamSize.value,
    captains: captains
  };
  const url=location.origin+location.pathname+"?data="+btoa(JSON.stringify(shareData));
  navigator.clipboard.writeText(url);
  alert("Share link copied!");
}

/* ===== LOAD FROM SHARE LINK ===== */
function loadFromURL(){
  const p=new URLSearchParams(location.search);
  if(p.has("data")){
    const decoded=JSON.parse(atob(p.get("data")));
    input.value=decoded.input;
    teamSize.value=decoded.size;
    if(decoded.mode==="draft" && decoded.captains && decoded.captains.length>0){
      captains=decoded.captains;
      prepareCaptainSelect();
      // mark captains visually
      Array.from(captainPool.children).forEach(el=>{
        if(captains.includes(el.textContent)) el.classList.add("selected");
      });
    } else {
      generateRandom();
    }
  }
}

loadFromURL();
</script>
</body>
</html>
